# MaiCLI AI 助手 - 重构和功能规划

本项目旨在提供一个命令行 AI 助手，使其更强大、更稳定、更易于使用。以下是未来的重构和功能规划。

## 1. 代码重构和清理 (已完成)

### 目标

- 统一代码风格和注释。
- 提高代码可读性和可维护性。
- 移除冗余和不必要的导入。

### 详细规划

- **统一 JSDoc 注释**：为所有函数、类、接口和导出的常量添加标准 JSDoc 注释，说明其用途、参数、返回值和可能抛出的错误。
- **统一命名约定**：变量、函数、类和常量应遵循一致的命名规则（例如，CamelCase、PascalCase、SCREAMING_SNAKE_CASE）。
- **精简代码**：删除多余的空行、不使用的导入 (`import JSON5 from 'json5';` 在 `network.ts` 中不再需要，但 `ai-response-parser.ts` 仍需使用) 和调试 `console.log`。
- **改进 `@types` 引用**：确保所有类型定义都放置在 `src/types` 中，并正确导入。

## 2. 核心功能增强

### 2.1 智能文件上下文管理

- **目标**：更智能地选择和提供文件上下文给 AI，避免超过上下文限制，同时确保相关性。
- **规划**：
  - **`.maiignore`支持**：实现类似 `.gitignore` 的文件，以排除不相关或敏感文件的上下文。
  - **基于语义的文件选择**：
    - 引入文件嵌入 (file embeddings) 或简单的关键词匹配，以根据用户提示自动选择最相关的文件。
    - 优先选择当前工作目录下的相关文件。
  - **上下文摘要而非完整内容**：对于大型文件，提供文件结构摘要（例如，函数/类名列表）而非整个文件内容。
  - **交互式上下文确认**：在发送请求前，允许用户审查和修改提供给 AI 的文件列表和内容。

### 2.2 增强的计划执行器

- **目标**：提高计划执行的鲁棒性、可见性和用户控制。
- **规划**：
  - **更精细的错误处理**：在执行每个操作时，提供更详尽的错误信息，并给出如何解决或跳过的建议。
  - **操作预览和确认**：在执行每个操作之前，提供更详细的预览（例如，文件差异），并允许用户逐个确认或跳过。
  - **事务性操作**：探索在支持的文件系统上实现事务性操作，确保所有更改要么全部成功，要么全部回滚。
  - **操作分组**：允许 AI 提交逻辑上相关的操作组，用户可以一次性确认或拒绝一组操作。

### 2.3 模板系统改进

- **目标**：使模板更加灵活和强大。
- **规划**：
  - **动态占位符**：支持更复杂的占位符类型，例如 `{{#each files}}...{{/each}}` 用于迭代文件列表。
  - **模板文件支持**：允许模板定义在单独的文件中，方便版本控制和共享。
  - **模板库**：建立一个社区维护的模板库，用户可以直接导入和使用。

### 2.4 历史记录和撤销/重做改进

- **目标**：增强版本控制功能，提供更友好的用户体验。
- **规划**：
  - **更详细的历史记录元数据**：除了当前信息，记录更多关于操作的信息，例如 Git 提交哈希（如果相关）、操作的来源 (template/direct prompt)。
  - **可视化历史快照**：允许用户查看历史快照中每个文件的具体内容，而不仅仅是操作列表。
  - **分支和合并**：一个更高级的功能，允许用户“分支”历史记录，然后合并回主线。

## 3. 用户体验 (UX) 改进

### 3.1 命令行界面增强

- **目标**：提供更直观、响应更迅速的命令行体验。
- **规划**：
  - **更丰富的输出样式**：利用 `chalk` 或其他库提供更具可读性的高亮和颜色（已部分实现）。
  - **加载指示器和进度条**：使用 `ora` 等库提供更好的长时间操作反馈（已部分实现）。
  - **自动补全**：为命令和参数提供 shell 自动补全。
  - **交互式模式**：除了当前的 `mai <prompt>` 模式，提供一个类似于 `git commit -m` 的更具引导性的交互模式。

### 3.2 配置管理

- **目标**：简化配置过程，支持多种配置源。
- **规划**：
  - **项目级配置**：除了全局配置外，支持在项目根目录（例如 `.mai.json`）配置，覆盖全局设置。
  - **环境变量集成**：更完善地支持通过环境变量进行配置。
  - **交互式配置向导**：初次使用时引导用户设置 API Key、默认模型等。

## 4. 扩展性和集成

### 4.1 更多 AI 模型支持

- **目标**：支持更广泛的 AI 模型和 API。
- **规划**：
  - **OpenAI (GPT-4 / GPT-3.5) API**：官方支持。
  - **Anthropic (Claude) API**：集成 Claude 模型。
  - **本地模型 (Ollama/LM Studio)**：探索与本地运行的 LLM 模型的集成，提供离线和隐私保护选项。

### 4.2 IDE 插件

- **目标**：与常用 IDE（如 VS Code）深度集成。
- **规划**：
  - **VS Code 插件**：提供上下文敏感的 AI 帮助、代码生成、重构和问题解决。
  - **文件修改预览**：在 IDE 中直接显示 AI 提议的文件更改。

## 5. 其他改进

- **单元测试和集成测试**：增加测试覆盖率，确保修改的稳定性和新功能的正确性。
- **文档完善**：为所有命令和配置项提供清晰、全面的文档。
- **性能优化**：对文件读取、AI 请求和操作执行进行性能分析和优化。
